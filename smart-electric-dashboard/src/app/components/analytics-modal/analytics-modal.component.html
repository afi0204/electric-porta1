<div class="modal-overlay" *ngIf="device" (click)="onOverlayClick($event)">
  <div class="modal-content-large">

    <div class="modal-header">
      <h3>Analytics for {{ device.name }}</h3>
      <button class="modal-close" (click)="onClose()">Ã—</button>
    </div>

    <!-- The modal body now contains a two-column grid -->
    <div class="modal-body">
      <div class="details-grid">

        <!-- ============================ -->
        <!--  LEFT COLUMN: DETAILS PANEL  -->
        <!-- ============================ -->
        <div class="details-panel">
          <div class="card">
            <h4><i class="fas fa-info-circle"></i> Information</h4>
            <div class="info-grid">
                <p><strong>Meter ID:</strong> <span>{{ device.deviceId }}</span></p>
                <p><strong>Status:</strong> <span class="status-badge" [ngClass]="device.status">{{ device.status }}</span></p>
                <p><strong>Meter Name:</strong> <span>{{ device.name }}</span></p>
                <p><strong>Signal:</strong> <span>{{ device.networkSignal }}%</span></p>
                <p><strong>Location:</strong> <span>{{ device.location }}</span></p>
                <p><strong>Installation:</strong> <span>{{ device.installationDate | date:'longDate' }}</span></p>
            </div>
          </div>
        </div>

        <!-- ============================= -->
        <!--  RIGHT COLUMN: CHARTS PANEL   -->
        <!-- ============================= -->
        <div class="analytics-panel">
          <div class="card">
            <div class="analytics-header">
                <h4>Consumption Analytics</h4>
                <select [ngModel]="period" (ngModelChange)="onPeriodChange($event)">
                    <option value="24h">Last 24 Hours</option>
                    <option value="7d">Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                </select>
            </div>
            <!-- This grid is now conditional -->
            <div class="charts-grid" *ngIf="renderCharts && !isLoading; else loadingState">
                <!-- Chart 1: Daily Consumption -->
                <div class="card">
                    <app-consumption-line-chart [readings]="deviceReadings" [period]="period"></app-consumption-line-chart>
                </div>

                <!-- Chart 2: Cumulative Consumption -->
                <div class="card">
                    <app-cumulative-chart [readings]="deviceReadings"></app-cumulative-chart>
                </div>

                <!-- Chart 3: Day/Night Pie Chart -->
                <div class="card">
                    <app-day-night-pie-chart [readings]="deviceReadings"></app-day-night-pie-chart>
                </div>
            </div>
            <ng-template #loadingState>
                <div class="loading-placeholder">Loading chart data...</div>
            </ng-template>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
