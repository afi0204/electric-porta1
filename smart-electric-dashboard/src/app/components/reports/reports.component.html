<div class="reports-container">
  <header class="reports-header">
    <h1>Consumption Analytics</h1>
    <p>Visualize energy usage across locations and time periods</p>
  </header>

  <div class="card filter-panel animated-panel">
    <div class="form-row">
      <div class="form-group">
        <label for="fromDate">From Date</label>
        <input id="fromDate" type="date" [(ngModel)]="fromDate" class="form-control">
      </div>
      <div class="form-group">
        <label for="toDate">To Date</label>
        <input id="toDate" type="date" [(ngModel)]="toDate" class="form-control">
      </div>
      <div class="form-group">
        <label for="location">Location</label>
        <select id="location" [(ngModel)]="location" class="form-control">
          <option value="All">All Locations</option>
          <option *ngFor="let loc of availableLocations" [value]="loc">{{ loc }}</option>
        </select>
      </div>
      <button class="btn-primary generate-btn" (click)="generateReport()" [disabled]="isLoading">
        <i class="fas fa-chart-bar" [class.spinning]="isLoading"></i>
        {{ isLoading ? 'Generating Report...' : 'Generate Report' }}
      </button>
    </div>
  </div>

  <div *ngIf="reportData.length > 0 && !isLoading" class="report-results">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="card summary-card animated-card">
        <h3><i class="fas fa-bolt"></i> Total Consumption</h3>
        <p class="big-number">{{ grandTotal | number }} kWh</p>
        <p class="subtext">Across all locations</p>
      </div>

      <div class="card summary-card animated-card">
        <h3><i class="fas fa-map-marker-alt"></i> Locations</h3>
        <p class="big-number">{{ locationCount }}</p>
        <p class="subtext">Included in report</p>
      </div>
    </div>

    <!-- Location Charts -->
    <div class="card location-charts">
      <h3>Consumption by Location</h3>
      <div class="chart-container">
        <app-location-chart [data]="reportData"></app-location-chart>
      </div>
    </div>

    <!-- Time Series Chart -->
    <div class="card time-series-chart">
      <h3>Consumption Over Time</h3>
      <div class="chart-container">
        <app-time-series-chart [data]="reportData" [fromDate]="fromDate" [toDate]="toDate"></app-time-series-chart>
      </div>
    </div>

    <!-- Results Table -->
    <div class="card results-table">
      <h3>Detailed Meter Data</h3>
      <div class="table-responsive">
        <table class="animated-table">
          <thead>
            <tr>
              <th>Meter</th>
              <th>Location</th>
              <th>Consumption</th>
              <th>Trend</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of reportData" class="animated-row">
              <td>
                <div class="meter-info">
                  <i class="fas fa-tachometer-alt"></i>
                  <span>{{ item.deviceName }}</span>
                </div>
              </td>
              <td>{{ item.location }}</td>
              <td>{{ item.totalConsumption | number }} Wh</td>
              <td>
                <app-sparkline-chart [data]="item.dailyConsumption"></app-sparkline-chart>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div *ngIf="reportData.length === 0 && !isLoading" class="no-results animated-fade">
    <div class="empty-state">
      <i class="fas fa-chart-pie"></i>
      <h3>No Report Data</h3>
      <p>Select date range and location to generate consumption analytics</p>
      <button class="btn-secondary" (click)="generateSampleReport()">
        <i class="fas fa-magic"></i> Load Sample Data
      </button>
    </div>
  </div>
</div>
